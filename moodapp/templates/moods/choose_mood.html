{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container py-5">
    <h1 class="text-center mb-4">Comment vous sentez-vous aujourd'hui ?</h1>

    <!-- S√©rie -->
    <div id="mood-streak" class="alert alert-info text-center d-none">
        üî• S√©rie d'humeurs positives : <span id="streak-count"></span> jours cons√©cutifs !
    </div>

    <!-- Humeur du jour avec fond dynamique -->
    {% if mood %}
    <div id="today-mood" class="alert text-center mood-{{ mood.name|lower|default:"default" }}">
        <h3 id="mood-text">{{ mood.name }}</h3>
        <p id="mood-message">Belle journ√©e en perspective !</p>
    </div>
    {% endif %}

    <form method="post" action="{% url 'add_user_mood' %}" class="p-4 shadow bg-white rounded mx-auto" style="max-width: 500px;">
        {% csrf_token %}

        <!-- Suggestion m√©t√©o -->
        <div class="mb-3 d-none" id="suggested-mood">
            <p id="suggested-mood-text" class="form-text"></p>
        </div>

        <!-- S√©lection d'humeur -->
        <div class="mb-3">
            <label for="mood" class="form-label"><i class="fas fa-smile"></i> Choisissez une humeur :</label>
            <select name="mood_id" id="mood" class="form-select">
                {% for mood_option in moods %}
                <option value="{{ mood_option.id }}">{{ mood_option.name }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- Commentaire -->
        <div class="mb-3">
            <label for="note" class="form-label">Note / Commentaire :</label>
            <textarea id="note" name="note" class="form-control" rows="3" placeholder="Qu'est-ce qui a influenc√© votre humeur aujourd'hui ?"></textarea>
        </div>

        <!-- Coordonn√©es -->
        <input type="hidden" name="latitude" id="latitude">
        <input type="hidden" name="longitude" id="longitude">

        <!-- Bouton -->
        <button type="submit" class="btn btn-primary w-100">
            <i class="fas fa-save"></i> Enregistrer
        </button>
    </form>
</div>

<!-- Scripts -->
<script src="{% static 'js/moods_chart.js' %}"></script>
<script src="{% static 'js/mood.js' %}"></script>
<script src="{% static 'js/streak.js' %}"></script>

<!-- G√©olocalisation -->
<script>
    document.addEventListener("DOMContentLoaded", () => {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    document.getElementById("latitude").value = position.coords.latitude;
                    document.getElementById("longitude").value = position.coords.longitude;
                },
                function(error) {
                    console.warn("G√©olocalisation refus√©e ou √©chou√©e :", error);
                }
            );
        }
    });
</script>
{% endblock %}
